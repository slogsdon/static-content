{"file":"posts/2013-04-14-installing-nginx-percona-php-fpm-with-homebrew-on-mountain-lion.md","type":"posts","slug":"posts/installing-nginx-percona-php-fpm-with-homebrew-on-mountain-lion","date":"2013-04-14T00:00:00.000Z","title":"Installing nginx/percona/php-fpm with homebrew on Mountain Lion","author":"shane","layout":"post","categories":["All Posts"],"tags":["devops","homebrew","mysql","nginx","percona","php"],"alias":["/installing-nginx-percona-php-fpm-with-homebrew-on-mountain-lion/","/installing-nginxperconaphp-fpm-with-homebrew-on-mountain-lion/","/devops/installing-nginx-percona-php-fpm-with-homebrew-on-mountain-lion/","/post/installing-nginx-percona-php-fpm-with-homebrew-on-mountain-lion/","/posts/devops/installing-nginx-percona-php-fpm-with-homebrew-on-mountain-lion/"],"content":"<p>If it helps anyone else, that&#39;s an added bonus, but this is mainly just a reference point for me; I&#39;m always forgetting what all needs to be done setting up a development environment going. <a href=\"http://getmnpp.org\">MNPP</a> doesn&#39;t seem to work well, and I&#39;m too cheap at the moment to pay for for <a href=\"http://www.mamp.info/en/mamp-pro/\">MAMP Pro</a>. Plus, MAMP uses Apache which I&#39;ve been trying to get away from for the past few months because of its slowness.</p>\n<!--more-->\n<h2 id=\"preparation\">Preparation</h2>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\"># Get Xcode via the App Store and install command-line tools (1.6+GB)</span>\n\n<span class=\"hljs-comment\"># Grab homebrew</span>\nruby <span class=\"hljs-_\">-e</span> <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$(curl -fsSL https://raw.github.com/mxcl/homebrew/go)</span>\"</span>\n\n<span class=\"hljs-comment\"># Grab the taps we'll need later</span>\nbrew tap josegonzalez/homebrew-php\nbrew tap homebrew/dupes\n</code></pre>\n<h2 id=\"install-percona\">Install Percona</h2>\n<p>This is a drop-in replacement for MySQL with built-in speed improvements. Double plus good.</p>\n<pre><code class=\"hljs language-bash\">brew install percona-server\nbrew link percona-server\n<span class=\"hljs-built_in\">unset</span> TMPDIR\nmysql_install_db --verbose --user=`whoami` --basedir=<span class=\"hljs-string\">\"<span class=\"hljs-variable\">$(brew --prefix percona-server)</span>\"</span> --datadir=/usr/<span class=\"hljs-built_in\">local</span>/var/percona --tmpdir=/tmp\nmkdir -p ~/Library/LaunchAgents\ncp /usr/<span class=\"hljs-built_in\">local</span>/opt/percona-server/homebrew.mxcl.percona-server.plist ~/Library/LaunchAgents/\nlaunchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.percona-server.plist\n</code></pre>\n<h2 id=\"install-nginx\">Install nginx</h2>\n<p>This little guy&#39;s awesome. No overhead for static files. Can act as a reverse-proxy cache for HTTPS content. I prefer <a href=\"https://www.varnish-cache.org/\">Varnish</a> for HTTP, though.</p>\n<pre><code class=\"hljs language-bash\">brew install nginx\nsudo cp `brew --prefix nginx`/homebrew.mxcl.nginx.plist /Library/LaunchDaemons/\nsudo sed -i <span class=\"hljs-_\">-e</span> <span class=\"hljs-string\">'s/`whoami`/root/g'</span> `brew --prefix nginx`/homebrew.mxcl.nginx.plist\nsudo mkdir /var/<span class=\"hljs-built_in\">log</span>/nginx/\n</code></pre>\n<h2 id=\"install-php-fpm\">Install php-fpm</h2>\n<p>PHP&#39;s fastcgi process manager. Kind of a resource hog, but better than using Apache/mod_php.</p>\n<pre><code class=\"hljs language-bash\">brew install --without-apache --with-fpm --with-mysql php54\nsudo cp `brew --prefix php54`/homebrew-php.josegonzalez.php54.plist  /Library/LaunchAgents/\nsudo launchctl load -w /Library/LaunchAgents/homebrew-php.josegonzalez.php54.plist\nphp-fpm -v\nsudo mv /usr/sbin/php-fpm /usr/sbin/php-fpm.bak\nsudo ln <span class=\"hljs-_\">-s</span> /usr/<span class=\"hljs-built_in\">local</span>/Cellar/php54/5.4.11/sbin/php-fpm /usr/sbin/php-fpm\nphp-fpm -v\nphp -v\nsudo mv /usr/bin/php /usr/bin/php.bak\nsudo ln <span class=\"hljs-_\">-s</span> /usr/<span class=\"hljs-built_in\">local</span>/bin/php /usr/bin/php\nphp -v\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'export PATH=$PATH:/usr/local/sbin'</span> &amp;gt;&amp;gt; ~/.zshrc <span class=\"hljs-comment\"># or ~/.bash_profile</span>\n</code></pre>\n<h5 id=\"configuration-files\">Configuration Files</h5>\n<ul>\n<li><code>/usr/local/etc/nginx/nginx.conf</code></li>\n<li><code>/usr/local/etc/php/5.4/php.ini</code></li>\n<li><code>/usr/local/etc/nginx/fastcgi_params</code></li>\n</ul>\n<p>Stop nginx with <code>nginx -s stop</code>, start with <code>nginx</code>, and reload config with <code>nginx -s reload</code>. Homebrew installs under <code>/usr/local</code>, so <code>sudo</code> shouldn&#39;t be needed when issuing those commands.</p>\n<p>Percona steps from <a href=\"http://wizardmode.com/2012/06/apache-php-mysql-dev-on-os-x-lion-with-a-minimum-of-pain/\">Wizard Mode</a>. nginx and php-fpm steps from <a href=\"http://mwholt.blogspot.com/2013/03/install-nginxphpmysql-on-os-x-mountain.html\">Matthew Holt</a>.</p>\n"}